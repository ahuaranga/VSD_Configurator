<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VSD Parameter Configurator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="app-container">
    
    <aside class="left-toolbar">
        <div class="toolbar-group top">
            
            <div class="hmi-btn home-btn" onclick="goHome()" title="Go Home">
                 <svg width="32" height="32" viewBox="0 0 24 24" fill="#1a2d4c"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            </div>
            
            <div class="hmi-btn menu-btn" onclick="toggleMenuSystem()" title="Open Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#1a2d4c">
                    <path d="M4 6 L8 8.5 L4 11 Z" />
                    <rect x="10" y="6" width="10" height="2" />
                    <rect x="10" y="10" width="10" height="2" />
                    <rect x="10" y="14" width="10" height="2" />
                    <rect x="4" y="14" width="4" height="2" />
                </svg>
            </div>
            
            <div class="hmi-btn download-btn" onclick="downloadConfig()" title="Download Config">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#1a2d4c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </div>

            <div class="hmi-btn config-btn" onclick="openConfigModal()" title="Configure Port">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 514 520" fill="currentColor"><path d="M 286 85 L 203 168 L 177 207 L 163 235 L 160 245 L 154 249 L 146 259 L 145 272 L 148 280 L 97 331 L 121 355 L 121 357 L 0 477 L 0 491 L 26 517 L 154 389 L 179 412 L 228 362 L 242 369 L 254 368 L 263 362 L 268 353 L 296 343 L 319 331 L 339 318 L 354 306 L 430 230 Z M 407 1 L 317 91 L 328 102 L 329 102 L 344 117 L 344 118 L 423 197 L 425 197 L 442 180 L 442 179 L 459 162 L 460 162 L 465 157 L 465 156 L 475 146 L 476 146 L 477 145 L 477 144 L 513 108 L 465 60 L 465 59 L 419 14 L 419 13 Z M 454 86 L 456 86 L 477 107 L 477 109 L 461 125 L 460 125 L 438 103 L 438 102 Z M 404 34 L 426 56 L 426 57 L 410 73 L 408 73 L 388 53 L 388 52 L 387 51 L 387 50 L 394 43 L 395 43 L 396 42 L 396 41 L 402 35 L 403 35 Z" fill-rule="evenodd"/></svg>
            </div>

            <div class="hmi-btn start-btn" onclick="startCommunication()" title="Start Communication">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#2e7d32" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"/> <path d="M5 12l4-4"/> <path d="M5 12l4 4"/> 
                    <path d="M19 12l-4-4"/> <path d="M19 12l-4 4"/>
                    <circle cx="12" cy="12" r="3" fill="#2e7d32" stroke="none"/>
                </svg>
            </div>

            <div class="hmi-btn stop-btn" onclick="stopCommunication()" title="Stop Communication">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#c62828" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 12h5"/> <path d="M15 12h5"/> <path d="M10 8l4 8"/> <path d="M14 8l-4 8"/>
                </svg>
            </div>

            <div class="hmi-btn chart-btn" onclick="openChartModule()" title="Open Chart">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#673ab7" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 20h18" />
                    <path d="M3 4v16" />
                    <path d="M3 15l5-5 5 5 8-8" />
                </svg>
            </div>
        </div>

        <div class="toolbar-group bottom">
            <div class="hmi-btn text-icon-btn" title="PM Function">PM</div>
            <div class="hmi-btn text-icon-btn" title="IM Function">IM</div>
        </div>
    </aside>

    <div class="right-layout">
        <header class="top-bar">
            <div class="header-left-group">
                <div class="breadcrumb" id="breadcrumb"></div>
            </div>
            <div class="status-bar">
                <div id="top-conn-indicator" class="conn-indicator">
                    <span class="led-dot"></span>
                    <span class="conn-text">Disconnected</span>
                </div>
                <span class="user-id">Instruct00</span>
                <span class="datetime" id="clock">-- --- ---- --:--:--</span>
            </div>
        </header>

        <div class="content-area">
            <nav class="sidebar-main" id="mainMenu"><ul id="mainList"></ul></nav>
            <nav class="sidebar-sub" id="subMenu"><ul id="subList"></ul></nav>

            <main class="main-panel">
                
                <div id="view-home" class="view-section">
                    <div class="home-placeholder"><h1>PARAMETER CONFIGURATOR</h1><p>Variable Speed Drive.</p></div>
                </div>

                <div id="view-default" class="view-section" style="display: none;">
                    <h2 id="default-title">Option</h2><div class="content-placeholder">Panel under construction</div>
                </div>

                <div id="view-speed" class="view-section" style="display: none;">
                    <div class="control-box highlight-box"><div class="box-header"><span class="box-number">1</span><span class="box-title">Source:</span></div><div class="box-content"><select class="full-width-select"><option>Target Speed</option></select></div></div>
                    <div class="columns-container">
                        <fieldset class="group-box"><legend>2 Feedback</legend>
                            <div class="form-row highlight-cyan"><label>If feedback increases:</label><select><option>Increase Speed</option></select></div>
                            <div class="form-row"><label>Feedback Value:</label><input type="text" value="0" readonly class="input-readonly"></div>
                            <div class="form-row"><label>Setpoint:</label><input type="number" value="3200"></div>
                            <div class="form-row"><label>Step Size (Hz):</label><input type="number" value="1"></div>
                            <div class="form-row"><label>Step Interval (s):</label><input type="number" value="10"></div>
                            <div class="form-row"><label>Dead Band (%):</label><input type="number" value="1"></div>
                            <div class="form-row"><label>Speed(Hz):</label><span class="value-text">0</span></div>
                        </fieldset>
                        <fieldset class="group-box"><legend>Parameters</legend>
                            <div class="form-row"><label>Target Speed (Hz):</label><input type="number" value="60"></div>
                            <div class="form-row"><label>Maximum (Hz):</label><input type="number" value="60"></div>
                            <div class="form-row"><label>Minimum (Hz):</label><input type="number" value="20"></div>
                            <div class="form-row"><label>Startup Freq. (Hz):</label><input type="number" value="7" class="input-transparent"></div>
                            <div class="form-row"><label>Carrier Freq. (kHz):</label><select class="blue-select"><option>2</option></select></div>
                        </fieldset>
                    </div>
                </div>

                <div id="view-configure" class="view-section" style="display: none;">
                    <div class="columns-container">
                        
                        <fieldset class="group-box">
                            <legend>Configuration</legend>
                            
                            <div class="form-row highlight-cyan">
                                <label>1 Motor Control Mode:</label>
                                <select>
                                    <option value="1">1: InductionVHz</option>
                                    <option value="2">2: PM VHz</option>
                                    <option value="3">3: Induction Adj Volt</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>2 Voltage Class:</label>
                                <select>
                                    <option value="1">1: Low (400V)</option>
                                    <option value="2" selected>2: High (480V)</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>3 Transformer Ratio:</label>
                                <input id="cfg-transformer-ratio" type="number" value="1">
                            </div>

                            <div class="form-row">
                                <label>4 Stop Method:</label>
                                <select>
                                    <option value="1" selected>1: Coast</option>
                                    <option value="2">2: Decel</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>5 Catch a Spinning Motor:</label>
                                <select>
                                    <option value="1">1: Yes</option>
                                    <option value="2" selected>2: No</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>6 Catch a Spinning Motor Mode:</label>
                                <select>
                                    <option value="1">1: Enhanced</option>
                                    <option value="2" selected>2: Sweep</option>
                                    <option value="3">3: Sweep2</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>7 Rotation:</label>
                                <select>
                                    <option value="1" selected>1: 0</option>
                                    <option value="2">2: 1</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label>8 Reverse While Running:</label>
                                <button class="btn-gray">Set</button>
                            </div>

                            <div class="form-row">
                                <label>9 Power Ridethrough:</label>
                                <select class="blue-select">
                                    <option value="1">1: Disable</option>
                                    <option value="2">2: Enable</option>
                                </select>
                            </div>

                            <div class="form-row label-center">
                                <label>RO0: Contactor</label>
                            </div>

                            <div class="form-row">
                                <label>Output Relay (RO1) Off Delay (s):</label>
                                <input type="number" value="300">
                            </div>

                            <div class="form-row">
                                <label>Door Open (DI0) Action:</label>
                                <select class="blue-select">
                                    <option value="1" selected>Bypass</option>
                                    <option value="2">Log</option>
                                    <option value="3">Stop</option>
                                    <option value="4">Stop & Log</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>ESD Switch (DI1) Action:</label>
                                <select class="blue-select">
                                    <option value="1" selected>Bypass</option>
                                    <option value="2">Log</option>
                                    <option value="3">Stop</option>
                                    <option value="4">Stop & Log</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>Heat Exchanger (DI2) Action:</label>
                                <select class="blue-select">
                                    <option value="1" selected>Bypass</option>
                                    <option value="2">Log</option>
                                    <option value="3">Stop</option>
                                    <option value="4">Stop & Log</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>Safety Switch (DI3) Action:</label>
                                <select class="blue-select">
                                    <option value="1" selected>Bypass</option>
                                    <option value="2">Log</option>
                                    <option value="3">Stop</option>
                                    <option value="4">Stop & Log</option>
                                </select>
                            </div>
                            <div class="form-row active-param">
                                <label>Door Interlock (DI5) Action:</label>
                                <select class="blue-select">
                                    <option value="1" selected>Bypass</option>
                                    <option value="2">Log</option>
                                </select>
                            </div>
                        </fieldset>

                        <div class="stack-container">
                            <fieldset class="group-box">
                                <legend>Motor Nameplate Parameters</legend>
                                <div class="form-row"><label>Amps (A):</label><input type="number" value="10"></div>
                                <div class="form-row"><label>P26 Setting (A):</label><input type="text" value="10.00" disabled class="input-disabled"></div>
                                
                                <div class="form-row">
                                    <label>VSD Speed (RPM):</label>
                                    <input id="cfg-vsd-speed" type="text" value="1800">
                                </div>
                                
                                <div class="form-row"><label>Power (kW):</label><input type="number" value="75"></div>
                                <div class="form-row"><label>Poles:</label><input type="number" value="4"></div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>Base Parameters</legend>
                                <div class="form-row">
                                    <label>Volts (V):</label>
                                    <input id="cfg-base-volts" type="number" value="460">
                                </div>
                                <div class="form-row"><label>Frequency (Hz):</label><input type="number" value="60"></div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>Tracking</legend>
                                <div class="form-row">
                                    <label>Tracking:</label>
                                    <input type="number" value="85">
                                </div>
                                <div class="form-row checkbox-row">
                                    <input type="checkbox" id="chk-underload">
                                    <label for="chk-underload">Underload Tracking On</label>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>

                <div id="view-time" class="view-section" style="display: none;">
                   <div class="columns-container">
                        <fieldset class="group-box"><legend>Accel/Decel</legend>
                            <div class="form-row highlight-cyan"><label>1 Accel Rate (Hz/s):</label><input type="number" value="9"></div>
                            <div class="form-row"><label>2 Decel Rate (Hz/s):</label><input type="number" value="3"></div>
                            <div class="form-row"><label>Accel. Time (s):</label><span>60</span></div>
                            <div class="form-row"><label>Decel. Time (s):</label><span>60</span></div>
                            <div class="form-row"><label>Ramp Freq. (Hz):</label><span>90</span></div>
                            <div class="form-row"><label>3 Pattern:</label><select class="blue-select"><option>Linear</option></select></div>
                        </fieldset>
                        <fieldset class="group-box"><legend>Extended Ramp</legend>
                            <div class="form-row"><label>Enable:</label><select class="blue-select"><option>Off</option></select></div>
                            <div class="form-row"><label>Step Size (Hz):</label><input type="number" value="1"></div>
                            <div class="form-row"><label>Step Interval (s):</label><input type="number" value="10"></div>
                        </fieldset>
                    </div>
                    <fieldset class="group-box" style="margin-top: 15px;"><legend>Acceleration/Deceleration Time:</legend><div class="info-panel">With a start frequency of 7 Hz...</div></fieldset>
                </div>

                <div id="view-alarms" class="view-section" style="display: none;">
                    <div class="columns-container">
                        <div class="stack-container">
                            <fieldset class="group-box"><legend>Motor Current</legend>
                                <div class="form-row highlight-cyan" id="row-overcurrent" ondblclick="openAlarmModal('overcurrent', '1 Overcurrent (A)')">
                                    <label>1 Overcurrent (A):</label><span id="val-overcurrent">200</span><span id="act-overcurrent" class="bypass-text">Bypass</span>
                                </div>
                                <div class="form-row" id="row-undercurrent" ondblclick="openAlarmModal('undercurrent', '2 Undercurrent (A)')">
                                    <label>2 Undercurrent (A):</label><span id="val-undercurrent">20</span><span id="act-undercurrent" class="bypass-text">Bypass</span>
                                </div>
                                <div class="form-row"><label>3 Current Source:</label><select class="blue-select"><option value="1">1: VSD Current</option><option value="2">2: CT Slot A</option><option value="3">3: CT Slot B</option></select></div>
                            </fieldset>
                            <fieldset class="group-box"><legend>Feedback</legend>
                                <div class="form-row"><label>Feedback High:</label><span>3210</span><span class="bypass-text">Bypass</span></div>
                                <div class="form-row"><label>Feedback Low:</label><span>3100</span><span class="bypass-text">Bypass</span></div>
                            </fieldset>
                            <fieldset class="group-box"><legend>VSD Trip</legend>
                                <div class="form-row"><label>Action:</label><select class="blue-select"><option value="Stop">1: Stop</option><option value="Stop&Log" selected>2: Stop&Log</option></select></div>
                                <div class="form-row"><label>Restarts:</label><input type="number" value="0" class="input-right"></div>
                                <div class="form-row"><label>Restart Delay (min):</label><input type="number" value="30" class="input-right"></div>
                            </fieldset>
                            <fieldset class="group-box"><legend>VSD Comm</legend>
                                <div class="form-row"><label>Action:</label><select class="blue-select"><option value="Stop">1: Stop</option><option value="Stop&Log">2: Stop&Log</option></select></div>
                                <div class="form-row"><label>Restarts:</label><input type="number" value="0" class="input-right"></div>
                                <div class="form-row"><label>Restart Delay (min):</label><input type="number" value="30" class="input-right"></div>
                            </fieldset>
                        </div>
                        <div class="stack-container">
                            <fieldset class="group-box"><legend>Voltage Input</legend>
                                <div class="form-row" id="row-voltage-high" ondblclick="openAlarmModal('voltage-high', 'Voltage Input High (V)')">
                                    <label>Voltage Input High (V):</label><span id="val-voltage-high">470</span><span id="act-voltage-high" class="bypass-text">Bypass</span>
                                </div>
                                <div class="form-row" id="row-voltage-low" ondblclick="openAlarmModal('voltage-low', 'Voltage Input Low (V)')">
                                    <label>Voltage Input Low (V):</label><span id="val-voltage-low">450</span><span id="act-voltage-low" class="bypass-text">Bypass</span>
                                </div>
                            </fieldset>
                            <fieldset class="group-box"><legend>VSD Warning</legend>
                                <div class="form-row"><label>Action:</label><select class="blue-select"><option value="Bypass">1: Bypass</option><option value="Log">2: Log</option></select></div>
                                <div class="form-row checkbox-row"><label>Suppress Accum RT Warning:</label><input type="checkbox"></div>
                            </fieldset>
                            <fieldset class="group-box"><legend>Torque</legend>
                                <div class="form-row"><label>Torque High</label><span>1</span><span class="bypass-text">Bypass</span></div>
                                <div class="form-row"><label>Torque Low</label><span>1</span><span class="bypass-text">Bypass</span></div>
                            </fieldset>
                            <fieldset class="group-box"><legend>Input Phase Loss</legend>
                                <div class="form-row"><label>Phase Loss Action:</label><select class="blue-select"><option value="Bypass">1: Bypass</option><option value="Log" selected>2: Log</option><option value="Stop&Log">3: Stop & Log</option></select></div>
                                <div class="form-row"><label>Phase Loss Lvl:</label><input type="number" value="325"></div>
                            </fieldset>
                        </div>
                    </div>
                </div>

<div id="view-expert" class="view-section" style="display: none;">
                   <div class="columns-container">
                        
                        <div class="stack-container">
                            
                            <fieldset class="group-box">
                                <legend>Troubleshooting</legend>
                                <div class="form-row highlight-cyan" style="justify-content: space-between;">
                                    <label>Trip on Comms loss is Enabled</label>
                                    <button class="btn-gray">Disable</button>
                                </div>
                                <div class="form-row label-center">
                                    <label>Spurious Count: 0</label>
                                </div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>Speed Force</legend>
                                <div class="form-row highlight-cyan">
                                    <label>1 Source:</label>
                                    <select class="blue-select">
                                        <option value="1">1: Din 1</option>
                                        <option value="2">2: Din 2</option>
                                        <option value="3">3: Din 3</option>
                                        <option value="4">4: Din 4</option>
                                        <option value="5">5: Din 5</option>
                                        <option value="6">6: Din 6</option>
                                        
                                        <optgroup label="7: Din B">
                                            <option value="71">1: Din B 1</option>
                                            <option value="72">2: Din B 2</option>
                                            <option value="73">3: Din B 3</option>
                                            <option value="74">4: Din B 4</option>
                                            <option value="75">5: Din B 5</option>
                                            <option value="76">6: Din B 6</option>
                                        </optgroup>
                                        
                                        <option value="8" selected>8: Off</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>2 Frequency (Hz):</label>
                                    <input type="number" value="60">
                                </div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>Expert Start</legend>
                                <div class="form-row">
                                    <label>Rock Freq. (Hz):</label>
                                    <input type="number" value="9.99">
                                </div>
                                <div class="form-row">
                                    <label>Pattern:</label>
                                    <input type="number" value="1">
                                </div>
                                <div class="form-row">
                                    <label>Cycles:</label>
                                    <input type="number" value="0">
                                </div>
                                <div class="form-row">
                                    <label>Volt. Boost (%):</label>
                                    <input type="number" value="1">
                                </div>
                            </fieldset>

                        </div>

                        <div class="stack-container">
                            
                            <fieldset class="group-box">
                                <legend>Jump Frequencies</legend>
                                <div class="form-row"><label>Jump Freq. 1 (Hz):</label><input type="number" value="0"></div>
                                <div class="form-row"><label>Jump Freq. 2 (Hz):</label><input type="number" value="0"></div>
                                <div class="form-row"><label>Jump Freq. 3 (Hz):</label><input type="number" value="0"></div>
                                <div class="form-row"><label>Width:</label><input type="number" value="1"></div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>Speed Units</legend>
                                <div class="form-row highlight-cyan">
                                    <label>1 Speed Units:</label>
                                    <select class="blue-select">
                                        <option value="1" selected>1: Hz</option>
                                        <option value="2">2: RPM</option>
                                    </select>
                                </div>
                            </fieldset>

                            <fieldset class="group-box">
                                <legend>CASM/FS Tuning</legend>
                                <div class="form-row">
                                    <label>FS Ki:</label>
                                    <input type="number" value="150">
                                </div>
                                <div class="form-row">
                                    <label>FS Speed Reg Ki:</label>
                                    <input type="number" value="500">
                                </div>
                                <div class="form-row">
                                    <label>FS Speed Reg Kp:</label>
                                    <input type="number" value="150">
                                </div>
                                <div class="form-row">
                                    <label>FS Msrmnt CurLvl:</label>
                                    <input type="number" value="150">
                                </div>
                            </fieldset>

                        </div>
                    </div>
                </div>

               <div id="view-pmm-configure" class="view-section" style="display: none;">
                    <div class="columns-container">
                        
                        <fieldset class="group-box">
                            <legend>Electrical Stability</legend>
                            <div class="form-row highlight-cyan">
                                <label>1 Elect Stab Enable:</label>
                                <select class="blue-select dynamic-select">
                                    <option value="1">1: Disable</option>
                                    <option value="2">2: Enable</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>2 Stability Filter (s):</label>
                                <input type="text" value="5162.22">
                            </div>
                            <div class="form-row">
                                <label>3 Stability Voltage Gain:</label>
                                <input type="number" value="0">
                            </div>
                            <div class="form-row">
                                <label>4 Stability Angle Gain:</label>
                                <input type="text" value="790.43">
                            </div>
                            <div class="form-row">
                                <label>5 Current Limit Kd (s):</label>
                                <input type="number" value="0">
                            </div>
                        </fieldset>

                        <fieldset class="group-box">
                            <legend>Step Out Detection</legend>
                            <div class="form-row">
                                <label>Action:</label>
                                <select class="blue-select dynamic-select">
                                    <option value="1">1: Bypass</option>
                                    <option value="2">2: Log</option>
                                    <option value="3">3: Stop</option>
                                    <option value="4">4: Stop & Log</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>Minimum Arming Speed (%):</label>
                                <input type="number" value="20">
                            </div>
                            
                            <div class="form-row">
                                <label>Arming Speed (Hz):</label>
                                <span class="value-left">12.00</span>
                            </div>
                            
                            <div class="form-row">
                                <label>PowerFactor Low Setpoint:</label>
                                <input type="number" value="0.3">
                            </div>
                            <div class="form-row">
                                <label>PowerFactor Low Tracking (%):</label>
                                <input type="number" value="50">
                            </div>
                            <div class="form-row">
                                <label>Trip Time (s):</label>
                                <input type="number" value="5">
                            </div>
                        </fieldset>

                    </div>
                </div>

                <div id="view-pmm-configure-2" class="view-section" style="display: none;">
                    <div class="columns-container">
                        
                        <fieldset class="group-box">
                            <legend>3 PMM Setup</legend>
                            <div class="form-row highlight-cyan">
                                <label>Motor Setup Mode:</label>
                                <select id="pmm-setup-mode" class="blue-select dynamic-select" onchange="togglePMMFields()">
                                    <option value="1">1: Automatic Setup</option>
                                    <option value="2">2: Manual Setup</option>
                                    <option value="3">3: Expert Setup</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <label>Extended speed Mode</label>
                                <select id="pmm-ext-speed-mode" class="blue-select dynamic-select" onchange="toggleExtendedFreq()">
                                    <option value="1">1: Enable</option>
                                    <option value="2" selected>2: Disable</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>Required Surface Voltage:</label>
                                <input type="number" value="2000" class="pmm-input">
                            </div>

                            <div class="form-row" id="row-ext-base-freq" style="display: none;">
                                <label>Extended Base Freq:</label>
                                <input type="number" value="0" class="pmm-input">
                            </div>

                            <div class="form-row">
                                <label>SUT Primary:</label>
                                <input type="number" value="400" class="pmm-input">
                            </div>
                            <div class="form-row">
                                <label>SUT Secondary:</label>
                                <input type="number" value="2000" class="pmm-input">
                            </div>
                            <div class="form-row">
                                <label>Suggested Transformer Ratio:</label>
                                <span class="value-left">0</span>
                            </div>
                            <div class="form-row">
                                <label>Transformer Ratio:</label>
                                <span class="value-left">1</span>
                            </div>
                        </fieldset>

                        <fieldset class="group-box">
                            <legend>Live Values</legend>
                            <div class="form-row"><label>Motor Rated Speed (Hz):</label><span>60</span></div>
                            <div class="form-row"><label>PowerFactor:</label><span>0</span></div>
                            <div class="form-row"><label>Output Frequency (Hz):</label><span>0</span></div>
                            <div class="form-row"><label>Drive Amps (A):</label><span>0</span></div>
                            <div class="form-row"><label>Motor Amps (A):</label><span>0</span></div>
                            <div class="form-row"><label>Voltage Out (V):</label><span>0</span></div>
                            <div class="form-row"><label>Power Out (kW):</label><span>0</span></div>
                        </fieldset>
                    </div>
                </div>

                <div id="view-chart-module" class="view-section" style="display: none;">
                    
                    <div class="chart-top-section">
                        
                        <div class="chart-grid-layout">
                            
                            <div class="chart-dropdown-group area-sampling">
                                <span class="chart-label">Sampling (s)</span>
                                <select id="chart-sampling-select" class="chart-select" onchange="updateSamplingRate()">
                                    <option value="500">0.5</option>
                                    <option value="1000" selected>1.0</option>
                                    <option value="2000">2.0</option>
                                    <option value="5000">5.0</option>
                                    <option value="10000">10.0</option>
                                </select>
                            </div>

                            <button id="btn-swap-axis" class="btn-standard area-swap" onclick="swapVariableAxis()" disabled>Swap Axis ↔</button>
                            <button id="btn-clear-vars" class="btn-standard area-clear" onclick="clearAllVariables()" disabled>Clear All</button>

                            <div class="chart-dropdown-group area-dropdown">
                                <span class="chart-label">Variable</span>
                                <select id="chart-var-select" class="chart-select">
                                    <option value="" selected disabled hidden style="display:none"></option>
                                    
                                    <optgroup label="Power Input">
                                        <option value="vsd_supply_voltage">Supply Voltage</option>
                                    </optgroup>
                                    <optgroup label="Diagnostics">
                                        <option value="vsd_temperature">Temperature</option>
                                    </optgroup>
                                    <optgroup label="Down Hole Tool">
                                        <option value="dht_intake_pressure">Intake Pressure</option>
                                        <option value="dht_discharge_pressure">Discharge Pressure</option>
                                        <option value="dht_intake_temp">Intake Temp</option>
                                        <option value="dht_motor_temp">Motor Temp</option>
                                        <option value="dht_vibration">Vibration</option>
                                        <option value="dht_active_leakage">Active Leakage</option>
                                        <option value="dht_cz">DH Cz</option>
                                        <option value="dht_cf">DH Cf</option>
                                        <option value="dht_passive_leakage">Passive Leakage</option>
                                        <option value="dht_diff_pressure">Diff Pressure</option>
                                    </optgroup>
                                </select>
                            </div>
                            
                            <button class="btn-standard area-add" onclick="addVariableToChart()">Add Variable</button>
                            <button id="btn-remove-var" class="btn-standard area-remove" onclick="removeVariableFromChart()" disabled>Remove</button>
                        </div>

                        <div class="vertical-separator"></div>

                        <div style="display: flex; gap: 5px;">
                            <button id="btn-chart-start" class="btn-standard" onclick="startChart()" disabled style="font-weight: 900; color: #006400; height: 77px;">
                                ▶ Start
                            </button>
                            <button id="btn-chart-stop" class="btn-standard" onclick="stopChart()" disabled style="font-weight: 900; color: #8b0000; height: 77px;">
                                ■ Stop
                            </button>
                        </div>
                    </div>

                    <div class="chart-main-layout">
                        <div class="added-vars-box">
                            <ul id="chart-added-list" class="simple-list">
                                </ul>
                        </div>
                        <div class="chart-container">
                            <div style="flex: 1; position: relative; min-height: 0; width: 100%;">
                                <canvas id="realtimeChart"></canvas>
                            </div>
                            
                            <div id="custom-legend" class="custom-legend-container">
                                <div id="legend-left" class="legend-group left"></div>
                                <div id="legend-right" class="legend-group right"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <div id="alarm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-window">
            <fieldset class="group-box modal-fieldset">
                <legend id="modal-title">Alarm Configuration</legend>
                <div class="form-row highlight-cyan"><label>1 Action:</label><select id="modal-action" class="full-width-select" style="font-weight: bold;"><option value="Bypass">1: Bypass</option><option value="Log">2: Log</option><option value="Stop">3: Stop</option><option value="Stop_Log">4: Stop_Log</option></select></div>
                <div class="form-row"><label>2 Setpoint:</label><input id="modal-setpoint" type="number" value="0"></div>
                <div class="form-row"><label>3 Trip Time (s):</label><input type="number" value="16"></div>
                <div class="form-row"><label>4 Restarts:</label><input type="number" value="0"></div>
                <div class="form-row"><label>5 Restart Delay (min):</label><input type="number" value="30"></div>
                <div class="form-row" id="row-start-bypass"><label>6 Start Bypass (s):</label><input type="number" value="0"></div>
                <div class="form-row" id="row-maint-bypass" style="display: none;"><label>7 Maint. Bypass (min):</label><input type="number" value="0"></div>
                <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 8px;">
                    <button id="btn-edit-curve" class="modal-btn">7 Edit curve...</button>
                    <button class="modal-btn" onclick="saveAlarmChanges()">0 Save</button>
                    <button class="modal-btn" onclick="closeAlarmModal()">X Cancel</button>
                </div>
            </fieldset>
        </div>
    </div>

    <div id="config-modal" class="modal-overlay" style="display: none;">
       <div class="modal-window">
            <fieldset class="group-box modal-fieldset">
                <legend>Communication Parameters</legend>
                <div id="conn-settings-form">
                    <div class="form-row"><label>Port:</label><select id="serial-port" class="full-width-select" style="font-weight: bold;"><option value="" disabled selected>Searching...</option></select></div>
                    <div class="form-row"><label>Baud Rate:</label><select id="serial-baud" class="full-width-select"><option value="19200" selected>19200</option><option value="9600">9600</option><option value="38400">38400</option></select></div>
                    <div class="form-row"><label>Data Bits:</label><select id="serial-databits" class="full-width-select"><option value="8">8</option><option value="7">7</option></select></div>
                    <div class="form-row"><label>Parity:</label><select id="serial-parity" class="full-width-select"><option value="N" selected>None (N)</option><option value="E">Even (E)</option><option value="O">Odd (O)</option></select></div>
                    <div class="form-row"><label>Stop Bits:</label><select id="serial-stopbits" class="full-width-select"><option value="1">1</option><option value="2">2</option></select></div>
                    <div class="form-row"><label>Timeout (s):</label><input id="serial-timeout" type="number" value="1" class="input-right"></div>
                </div>
                <div style="margin-top: 15px; display: flex; flex-direction: row; gap: 8px;">
                    <button class="modal-btn" onclick="applyConfigParams()">Apply</button>
                    <button class="modal-btn" onclick="okConfigParams()">OK</button>
                    <button class="modal-btn" onclick="closeConfigModal()">Cancel</button>
                </div>
            </fieldset>
        </div>
    </div>

    <div id="status-modal" class="center-overlay" style="display: none;">
        <div class="status-box">
            <h3 id="status-title">Connecting...</h3>
            <div id="status-progress" class="progress-container" style="display: flex;">
                <div class="progress-bar-bg"><div id="progress-fill" class="progress-bar-fill"></div></div>
                <span id="status-text" class="status-detail">Starting protocol...</span>
            </div>
            <div id="status-error-area" style="display: none; margin-top: 10px;">
                <p id="error-message" style="color: #c62828; font-weight: bold; font-size: 13px;">Unknown error</p>
                <button class="modal-btn" style="margin-top: 10px;" onclick="closeStatusModal()">Close</button>
            </div>
        </div>
    </div>

</div>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>